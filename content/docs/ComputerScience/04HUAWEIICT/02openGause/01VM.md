---
# -------------------------------------------------------------------------------------
# |                           核心元数据 (Core Metadata)                            |
# -------------------------------------------------------------------------------------
title: "从零到一：在 VMware openEuler 虚拟机上部署 openGauss"
date: 2024-05-21
lastmod: 2024-05-21
draft: false
weight: 10

# -------------------------------------------------------------------------------------
# |                             SEO 与分享 (SEO & Sharing)                           |
# -------------------------------------------------------------------------------------
description: "终极指南：从创建一台网络稳定的 VMware 双网卡（NAT+仅主机）openEuler 虚拟机，到完整部署 openGauss 数据库的全过程。解决所有网络配置难题，一劳永逸。"
keywords: ["openGauss", "openEuler", "VMware", "数据库安装", "双网卡", "NAT", "仅主机", "SSH"]
images: []

# -------------------------------------------------------------------------------------
# |                            内容组织 (Taxonomies)                               |
# -------------------------------------------------------------------------------------
tags: ["openGauss", "VMware", "Linux", "openEuler", "Network", "Database", "DevOps"]
categories: ["Docs"]
series: ["openGauss 部署系列"]

# -------------------------------------------------------------------------------------
# |                         FixIt 主题特定配置 (Theme-Specific)                     |
# -------------------------------------------------------------------------------------
comment: true
toc: true
featuredImage: ""
---

## 前言

在 VMware 中部署 Linux 数据库（如 openGauss）时，最令人头疼的往往不是数据库本身，而是其赖以生存的网络环境。网络配置不当，会导致虚拟机无法上网、物理机无法稳定连接、IP 地址漂移等一系列问题，为后续的安装和维护埋下隐患。

本教程旨在提供一个**一劳永逸的终极解决方案**。我们将从零开始，采用**双网卡**的专业配置方案，创建一个稳定、可靠、可预测的网络环境，并在此基础上完成 openGauss 数据库的全部署流程。

**本教程将带你完成：**
1.  **配置 VMware 网络**：设置 NAT 和仅主机 (Host-Only) 两个虚拟网络。
2.  **创建双网卡虚拟机**：为 openEuler 虚拟机配置两张网卡，各司其职。
    *   **NAT 网卡**：负责让虚拟机自由访问互联网，用于更新系统、下载软件。
    *   **仅主机网卡**：在物理机和虚拟机间建立一条**私有、固定 IP** 的通道，专门用于 SSH 远程管理和数据库连接。
3.  **部署 openGauss**：在配置好的稳定环境中，顺利完成 openGauss 的安装与初始化。

本教程以 **VMware Workstation Pro** 和 **openEuler 22.03 LTS SP3** 为例，但其原理和步骤适用于几乎所有 Linux 发行版和数据库的部署场景。

---

## 第一部分：创建并配置网络稳定的虚拟机

在动手之前，我们需要先为虚拟机打下坚实的网络基础。

### 步骤 1: 配置 VMware 虚拟网络编辑器

1.  打开 VMware Workstation Pro，在顶部菜单栏点击 **编辑 (Edit)** > **虚拟网络编辑器 (Virtual Network Editor)**。
2.  点击右下角的 **更改设置 (Change Settings)** 获取管理员权限。
3.  **配置 NAT 网络 (VMnet8)**
    *   选中 **VMnet8 (NAT模式)**。
    *   **记下子网 IP (Subnet IP)**，例如：`192.168.56.0`。
    *   点击 **NAT 设置 (NAT Settings)**，**记下网关 IP (Gateway IP)**，例如：`192.168.56.2`。
4.  **配置仅主机网络 (VMnet1)**
    *   选中 **VMnet1 (仅主机模式)**。
    *   **记下子网 IP (Subnet IP)**，例如：`192.168.170.0`。
5.  点击“确定”保存。

### 步骤 2: 创建 openEuler 虚拟机

1.  在 VMware 中选择“创建新的虚拟机”，使用“典型”配置。
2.  加载你的 openEuler ISO 镜像文件。
3.  在“自定义硬件”步骤中，进行如下配置：
    *   **网络适配器 1**: 设置为 **NAT 模式**。
    *   点击左下角 **添加...** -> **网络适配器**，添加第二张网卡。
    *   **网络适配器 2**: 设置为 **仅主机 (Host-only)** 模式。
4.  完成创建，启动虚拟机进入安装程序。

### 步骤 3: 安装系统时的核心网络配置

在 openEuler 的“安装信息摘要”界面，点击“网络和主机名”，开始我们的核心配置。

#### 配置网卡 1 (ens33, NAT 模式, 用于上网)

1.  选中第一个网卡，点击右下角的 **“配置...”**。
2.  进入 **“IPv4 设置”** 标签页。
3.  **方法**: 改为 **“手动”**。
4.  点击 **“添加”**，并填写信息（使用步骤1记下的 NAT 网络信息）：
    *   **地址**: `192.168.56.130` (选择一个该网段未被占用的高位 IP)
    *   **子网掩码**: `255.255.255.0`
    *   **网关**: `192.168.56.2` (**至关重要！这是上网的出口**)
    *   **DNS 服务器**: `8.8.8.8, 114.114.114.114`
5.  点击 **“保存”**。

#### 配置网卡 2 (ens34, 仅主机模式, 用于管理)

1.  选中第二个网卡，点击 **“配置...”**。
2.  进入 **“IPv4 设置”** 标签页。
3.  **方法**: 改为 **“手动”**。
4.  点击 **“添加”**，并填写信息（使用步骤1记下的仅主机网络信息）：
    *   **地址**: `192.168.170.130` (我们将用这个**固定IP**来管理和配置数据库)
    *   **子网掩码**: `255.255.255.0`
    *   **网关**: **【绝对核心】此处必须留空！一个字都不要填！**
5.  点击 **“保存”**。

{{< admonition type="warning" title="关键提醒" >}}
一台机器只能有一个**默认网关**。我们的上网出口已经指定给了 NAT 网卡，所以“仅主机”网卡绝对不能再设置网关，否则会导致路由冲突。
{{< /admonition >}}

最后，确保两个网卡右上角的开关都拨到 **“ON” (开启)** 状态，然后点击“完成”，继续安装系统。

### 步骤 4: 验证网络配置

安装完成后，系统会自动重启。此时，我们可以从**物理机**打开 SSH 工具（如 PuTTY, MobaXterm），使用我们为**仅主机网卡**设置的固定 IP `192.168.170.130` 连接虚拟机。

用 `root` 用户登录后，进行最终验证。

1.  **检查 IP 地址**
    ```bash
    ip addr
    ```
    你应该能看到 `ens33` 和 `ens34` 分别获得了我们设置的 `192.168.56.130` 和 `192.168.170.130` 地址。

2.  **测试外网连接**
    ```bash
    ping baidu.com
    ```
    能 ping 通，说明 NAT 网卡工作正常。

至此，我们拥有了一台网络环境完美且稳定的虚拟机，可以开始部署 openGauss 了！

---

## 第二部分：openGauss 环境准备与配置

在已经配置好的虚拟机中，我们继续进行 openGauss 的安装准备工作。

### 步骤 1：关闭防火墙

为了避免防火墙策略影响数据库端口通信，我们直接关闭并禁用 `firewalld` 服务。

```bash
# 停止 firewalld 服务
systemctl stop firewalld.service

# 禁用 firewalld 服务，防止开机自启
systemctl disable firewalld.service