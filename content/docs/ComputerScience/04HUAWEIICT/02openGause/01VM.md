---
# -------------------------------------------------------------------------------------
# |                           核心元数据 (Core Metadata)                            |
# -------------------------------------------------------------------------------------
# 【必填】文章标题：清晰、吸引人，并包含核心关键词
title: "虚拟机安装和配置(网卡篇)"
# 【必填】文章发布日期
date: 2025-10-31T22:43:46+08:00
# 【建议】文章最后修改日期：更新文章后，请手动更新此日期，以告知搜索引擎内容已更新
lastmod: 2025-10-31T22:43:46+08:00
# 【必填】文章作者：FixIt主题支持多种格式
# 格式一: 简单字符串
# author: "ApolloMonasa"
# 格式二: 包含链接和头像的复杂对象 (推荐)
# author:
#     - {name: "wmsnp", link: "https://github.com/wmsnp", avatar: "https://i.ooxx.ooo/i/ZGM0M.jpg"}
#     - ApolloMonasa
# 【必填】是否为草稿：发布前请务必设置为 false
draft: false
weight: 10

# -------------------------------------------------------------------------------------
# |                             SEO 与分享 (SEO & Sharing)                           |
# -------------------------------------------------------------------------------------
# 【核心SEO】文章描述：1-3句话，准确概括文章内容，包含关键词。会显示在搜索引擎结果中。
description: "从零开始，手把手教你使用 VMware Workstation Pro 配置双网卡（NAT + 仅主机），为 Linux 虚拟机（以 openEuler 为例）搭建一个既能访问互联网，又能被物理机稳定 SSH 连接的完美网络环境。"
# 【建议SEO】文章关键词：针对本文的特定关键词，用逗号分隔
keywords: ["虚拟机", "VMware Workstation Pro"]
# 【可选SEO】自定义URL：用于创建更简洁或更具描述性的URL，不设置则根据标题自动生成
# slug: "custom-url-slug-for-this-post"
# 【核心分享】社交分享预览图 (og:image)：非常重要！推荐尺寸 1200x630。
# 如果不设置，将使用 params.toml 中定义的全局 images。
# 将图片放在 /static/images/posts/ 目录下，然后在这里引用。
images: [] # 例如: ["/images/posts/my-post-banner.png"]

# -------------------------------------------------------------------------------------
# |                            内容组织 (Taxonomies)                               |
# -------------------------------------------------------------------------------------
# 【必填】标签：可以有多个，用于内容聚合
tags: ["VMware", "Linux", "openEuler", "Network", "SSH", "DevOps"]
# 【必填】分类：通常只有一个，用于内容归档
categories: ["Docs"] # 例如: ["模组开发"]
# 【可选】系列：将多篇文章组织成一个系列，自动生成上一篇/下一篇链接
# series: [] # 例如: ["NeoForge 开发系列"]

# -------------------------------------------------------------------------------------
# |                         FixIt 主题特定配置 (Theme-Specific)                     |
# -------------------------------------------------------------------------------------
# 是否开启评论
comment: true
# 是否显示目录
toc: true
# 文章封面图：显示在文章列表和文章顶部
featuredImage: "" # 例如: "/images/posts/my-post-cover.jpg"
---


## 前置准备

### 下载VMware Workstation Pro

- 前往[Broadcom官网](https://broadcom.com)注册账号，并找到[下载界面](https://support.broadcom.com/group/ecx/productdownloads?subfamily=VMware%20Workstation%20Pro&freeDownloads=true)进行下载安装。

### 下载openEuler22.03LST SP3光盘映像文件

- 前往[openEuler官网](https://www.openeuler.openatom.cn/zh/download/)找到你要的版本，下载保存好。


## 前言

> 作者经常受这个问题的干扰，如今决定来彻底弄懂，于是写下这个教程，也录制了教学视频。

在使用 VMware 创建 Linux 虚拟机时，网络配置常常是新手最头疼的问题：要么虚拟机能上网但物理机连不上，要么物理机能连上但虚拟机又上不了网，甚至有时候网络会因为 Wi-Fi 环境的切换而时好时坏。

本文旨在提供一个**一劳永逸的解决方案**。我们将采用**双网卡**的配置方案，为虚拟机创建一个稳定可靠的网络环境。

**最终目标：**
1.  **NAT 网卡**：负责让虚拟机自由访问互联网，用于更新系统、下载软件。
2.  **仅主机 (Host-Only) 网卡**：负责在你的物理机和虚拟机之间建立一条**私有、永不改变**的通道，专门用于 SSH 远程连接和文件传输。

本教程以 **VMware Workstation Pro** 和 **openEuler 22.03 LTS SP3** 为例，但其原理和步骤适用于几乎所有 Linux 发行版（如 CentOS, Ubuntu, Rocky Linux 等）。

---

## 概念解析：网络配置的“道”

> 精通计算机网络者可以跳过，或阅读后给笔者修改建议，欢迎评论区提意见！

在动手之前，我们先用一个简单的比喻来理解几个核心概念，这将让后续的操作变得清晰明了。

想象一下，你的**物理电脑 (Host)** 是你的**家**，新创建的**虚拟机 (Guest)** 是家里的一个**智能机器人**。

- **IP 地址 (Address)**：每个设备的门牌号，例如 `192.168.56.130`。
- **子网 (Subnet)**：一条街道或一个小区，例如 `192.168.56.0` 代表“56号街”。同一条街上的邻居可以直接对话。
- **网关 (Gateway)**：小区的**唯一大门**，通往外面的世界（互联网）。所有要去外网的请求都必须经过这个大门。

我们的双网卡方案，就是给机器人安装两个功能不同的“门”：

| 网络模式 | 作用 |
| :--- | :--- | :--- |
| **NAT 模式** | 访问互联网 |
| **仅主机模式**| 仅与物理机通信 |

{{< admonition type="info" title="核心理念" >}}
我们让**上网**和**管理**这两件事，通过两张不同的网卡各司其职，互不干扰，从而实现网络环境的绝对稳定。
{{< /admonition >}}

---

## 第一步：准备工作 - 配置 VMware 虚拟网络编辑器


1.  打开 VMware Workstation Pro，在顶部菜单栏点击 **编辑 (Edit)** > **虚拟网络编辑器 (Virtual Network Editor)**。
2.  点击右下角的 **更改设置 (Change Settings)** 获取管理员权限。
3.  **配置 NAT 网络 (VMnet8)**
    *   选中 **VMnet8 (NAT模式)**。
    *   **记下子网 IP (Subnet IP)**，例如：`192.168.56.0`。
    *   点击 **NAT 设置 (NAT Settings)**，**记下网关 IP (Gateway IP)**，例如：`192.168.56.2`。
4.  **配置仅主机网络 (VMnet1)**
    *   选中 **VMnet1 (仅主机模式)**。
    *   **记下子网 IP (Subnet IP)**，例如：`192.168.170.0`。这个网络的网关通常是你物理机在该网络中的地址 `192.168.170.1`，但我们在虚拟机配置中**用不到它**。
5.  点击“确定”保存。

---

## 第二步：实战 - 创建并配置 openEuler 虚拟机

1.  在 VMware 中选择“创建新的虚拟机”，使用“典型”配置。
2.  加载你的 openEuler ISO 镜像文件，点击下一步，客户机操作系统选Linux，版本选“其他Linux内核5.x 64位”，然后下一步名称自取。
3.  然后基本上保持默认设置即可，内存（通常2-4GB）和磁盘（通常20GB，磁盘选择保存为单个文件）大小自定。
4.  在“自定义硬件”步骤中，进行如下配置：
    *   **网络适配器 1**: 默认是已经存在并且设置为 **NAT 模式**。
    *   点击左下角 **添加...** -> **网络适配器**，添加第二张网卡。
    *   **网络适配器 2**: 设置为 **仅主机 (Host-only)** 模式。
5.  完成创建，启动虚拟机进入安装程序。

---

## 第 2.5 步 系统安装时的其他设置

在openEuler的安装信息摘要，需要进行设置的地方，除了一会儿重点讲解的网卡配置之外，还有：

- 安装位置：选择“自定义”->“完成”->设置选“标准分区”->“点击这里自动创建它们”->“完成”->“接受更改”
- 软件选择：虚拟化主机->选“开发工具”“安全性工具”“系统工具”
- Root账户：设置密码

## 第三步：核心 - 安装系统时的网络配置

在 openEuler 的“安装信息摘要”界面，点击“网络和主机名”，开始我们的核心配置。

#### 配置网卡 1 (例如 `ens33`, NAT 模式, 外卖门)

1.  选中第一个网卡，点击右下角的 **“配置...”**。
2.  进入 **“IPv4 设置”** 标签页。
3.  **方法**: 改为 **“手动”**。
4.  点击 **“添加”**，并填写信息（使用第一步记下的 NAT 网络信息）：
    *   **地址**: `192.168.56.130` (选择一个该网段未被占用的高位 IP)
    *   **子网掩码**: `255.255.255.0`
    *   **网关**: `192.168.56.2` (**至关重要！这是上网的出口**)
    *   **DNS 服务器**: `8.8.8.8, 114.114.114.114`
5.  点击 **“保存”**。

#### 配置网卡 2 (例如 `ens34`, 仅主机模式, 内部对讲机)

1.  选中第二个网卡，点击 **“配置...”**。
2.  进入 **“IPv4 设置”** 标签页。
3.  **方法**: 改为 **“手动”**。
4.  点击 **“添加”**，并填写信息（使用第一步记下的仅主机网络信息）：
    *   **地址**: `192.168.170.130` (选择一个该网段未被占用的高位 IP)
    *   **子网掩码**: `255.255.255.0`
    *   **网关**: **【绝对核心】此处必须留空！一个字都不要填！**
5.  点击 **“保存”**。

{{< admonition type="warning" title="关键提醒" >}}
一台机器只能有一个**默认网关**。我们的上网出口已经指定给了 NAT 网卡，所以“仅主机”网卡绝对不能再设置网关，否则会导致路由冲突，机器人会“迷路”。
{{< /admonition >}}

最后，确保两个网卡右上角的开关都拨到 **“ON” (开启)** 状态，然后点击“完成”，继续安装系统。

---

## 第四步：验证与收尾 - 首次启动后的检查

安装完成后，用 root 用户登录虚拟机，进行最终验证。

1.  **检查 IP 地址**
    ```bash
    ip addr
    ```
    你应该能看到 `ens33` 和 `ens34` 分别获得了我们设置的 `192.168.56.130` 和 `192.168.170.130` 地址。

2.  **检查路由表（大脑地图）**
    ```bash
    ip route
    ```
    这是最重要的验证！输出结果**必须**只有一条以 `default` 开头的记录，并且是：
    `default via 192.168.56.2 dev ens33 ...`
    这表示默认出口已正确设置在 NAT 网卡上。

3.  **测试外网连接**
    ```bash
    ping baidu.com
    ```
    能 ping 通，说明虚拟机已成功连接互联网。

4.  **检查 SSH 服务**
    ```bash
    systemctl status sshd
    ```
    确保服务是 `active (running)` 状态。如果不是，请启动并设置开机自启：
    ```bash
    systemctl start sshd
    systemctl enable sshd
    ```

---

## 排错指南

如果在最后 SSH 连接时遇到问题，99% 是防火墙导致的。

#### 问题 1: SSH 连接提示 `Permission denied`

这是**虚拟机内部防火墙 (`firewalld`)** 拦截了请求。

**解决方案**：将我们的内部管理网卡 `ens34` 加入到信任区域。

```bash
# 将 ens34 网卡永久性地更改到 trusted 区域
firewall-cmd --permanent --zone=trusted --change-interface=ens34

# 重新加载防火墙使配置生效
firewall-cmd --reload
```

#### 问题 2: SSH 连接无提示

大概率是虚拟网卡Vment1的ip地址和仅主机连接网卡的ip地址不在一个网段，修改一下即可。

```bash
##进入网络适配器设置
ncpa.cpl
##然后选择Vment1调整设置即可，如我在此处就会设置为192.168.170.1
```

